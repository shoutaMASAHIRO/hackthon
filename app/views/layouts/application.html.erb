<!DOCTYPE html>
<html>
  <head>
    <title>Hobbyverse</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload', defer: true %>

    <style>
      /* ---------- Dark theme tokens ---------- */
      :root{
        --bg:#0b0b0f;
        --panel:#111217;
        --panel-2:#151720;
        --text:#e7e9ee;
        --muted:#b6bcc7;
        --line:#242633;
        --brand-1:#6ea8ff;
        --brand-2:#4f6cf7;
        --ok:#12c48b;
        --ng:#ff6b6b;
        --ring: 0 0 0 3px rgba(111,140,255,.25);
        --shadow: 0 10px 30px rgba(0,0,0,.35);
      }

      /* ---------- Base ---------- */
      *{ box-sizing:border-box }
      html,body{ height:100% }
      body { margin:0; background:var(--bg); color:var(--text);
             font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Sans", "ヒラギノ角ゴ ProN", Meiryo, sans-serif; }
      a{ color:inherit }

      .wrap   { max-width: 1100px; margin: 0 auto; padding: 0 16px; }
      .page   { max-width: 980px;  margin: 20px auto; padding: 0 16px; }

      /* ---------- Top bar ---------- */
      .topbar {
        position: sticky; top:0; z-index:10;
        background: linear-gradient(180deg, rgba(17,18,23,.85), rgba(17,18,23,.70));
        backdrop-filter: blur(8px);
        border-bottom:1px solid var(--line);
        box-shadow: 0 1px 0 rgba(255,255,255,.03), var(--shadow);
      }
      .topbar-inner {
        display:flex; align-items:center; gap:14px; padding:12px 0;
      }

      /* ---------- Brand (看板) ---------- */
      .brand{ margin:0 }
      .brand-link{
        display:flex; align-items:center; gap:12px;
        text-decoration:none; padding:6px 10px; border-radius:14px;
        position:relative;
        transition: transform .15s ease, filter .15s ease;
      }
      .brand-link::after{
        content:"";
        position:absolute; inset:-1px;
        border-radius:14px;
        background: radial-gradient(120px 40px at left, rgba(111,140,255,.18), transparent 60%);
        pointer-events:none; filter: blur(8px);
      }
      .brand-link:hover{ transform: translateY(-1px); }

      .brand-badge{ display:grid; place-items:center; width:44px; height:44px; }
      .brand-svg{ width:44px; height:44px; }
      .badge-bg{ fill:url(#g); }
      .badge-mark{ fill:#fff; opacity:.95; }
      .brand-svg stop[offset="0%"]{ stop-color: var(--brand-2); }
      .brand-svg stop[offset="100%"]{ stop-color: var(--brand-1); }

      .brand-text{
        font-weight:800; letter-spacing:.3px; font-size:22px; line-height:1.05;
        background: linear-gradient(90deg, var(--text), #dbe2ff 60%, var(--brand-1));
        -webkit-background-clip:text; background-clip:text; color:transparent;
        text-shadow: 0 0 18px rgba(111,140,255,.25);
        display:flex; flex-direction:column;
      }
      .brand-sub{
        font-weight:600; font-size:11px; letter-spacing:1.4px; text-transform:uppercase;
        color:var(--muted);
        margin-top:2px; opacity:.8;
      }

      /* ---------- Buttons & Inputs ---------- */
      .stack{ margin-left:auto; display:flex; flex-direction:column; align-items:flex-end; gap:10px; }
      .btn{
        display:inline-block; text-decoration:none;
        border-radius:10px; padding:10px 14px; font-size:14px; line-height:1;
        border:1px solid var(--line); background: var(--panel);
        color:var(--text); cursor:pointer;
        transition: transform .12s ease, filter .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
        width:max-content;
      }
      .btn:hover{ filter:brightness(1.06); transform: translateY(-1px); }
      .btn:focus-visible{ outline:none; box-shadow: var(--ring); }
      .btn-primary{
        border-color: transparent;
        background: linear-gradient(135deg, var(--brand-2), var(--brand-1));
        color:#fff;
        box-shadow: 0 8px 20px rgba(79,108,247,.25);
      }
      .btn-primary:hover{ filter: brightness(1.03); }
      .welcome-btn:hover{ transform: translateY(-2px); }

      .search-wrap{ margin-top:8px; width:100%; }
      .search-form{ display:flex; gap:8px; align-items:center; }
      .input{
        padding:10px 12px; border:1px solid var(--line); border-radius:10px; min-width:240px;
        background: var(--panel-2); color:var(--text);
      }
      .input::placeholder{ color:#7d8291; }
      .input:focus{ outline:none; box-shadow: var(--ring); border-color: rgba(111,140,255,.55); }

      /* ---------- Flash ---------- */
      .flash { margin:16px 0 12px; }
      .flash .notice, .flash .alert {
        padding:12px 14px; border-radius:10px; border:1px solid var(--line);
        margin:0 0 10px; background: var(--panel);
      }
      .flash .notice { border-color: rgba(18,196,139,.4); box-shadow: inset 0 0 0 1px rgba(18,196,139,.15); }
      .flash .alert  { border-color: rgba(255,107,107,.4); box-shadow: inset 0 0 0 1px rgba(255,107,107,.15); }

      /* ---------- Inline links ---------- */
      .inline-links .btn{ margin-right:8px; }

      /* ---------- Card ---------- */
      .card{
        background:var(--panel);
        border:1px solid var(--line);
        border-radius:14px;
        box-shadow: var(--shadow);
        padding:14px;
      }

      .btn-white {
        color: #fff !important;          /* 文字色を強制的に白 */
        border-color: var(--line);
        background: var(--panel);        /* 背景は黒基調に */
      }
      .btn-white:hover {
        filter: brightness(1.15);        /* ホバー時ちょっと明るく */
      }
      .brand-text {
      color: #fff;          /* メインテキストを白に */
      font-weight: bold;
    }
      .brand-text .brand-sub {
        display: block;       /* サブを改行表示したいなら */
        font-size: 0.85em;    /* サブは少し小さめ */
        color: #fff;          /* サブテキストも白に */
        opacity: 0.85;        /* 少し薄めにするなら */
    }
    </style>
  </head>

  <body>
    <header class="topbar">
      <div class="wrap">
        <div class="topbar-inner">
          <h1 class="brand">
            <%= link_to root_path, class: "brand-link" do %>
              <span class="brand-badge" aria-hidden="true">
                <svg viewBox="0 0 48 48" class="brand-svg" role="img" focusable="false">
                  <defs>
                    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                      <stop offset="0%" />
                      <stop offset="100%" 
                    </linearGradient>
                  </defs>
                  <rect x="2" y="2" width="44" height="44" rx="10" ry="10" class="badge-bg"/>
                  <path d="M12 34 L24 10 L36 34 Z M20 34 L28 18 L36 34 Z" class="badge-mark"/>
                </svg>
              </span>
              <span class="brand-text">
                Hobby_Verse
                <span class="brand-sub">create • share • enjoy</span>
              </span>
            <% end %>
          </h1>

          <nav style="margin-left:auto;">
            <% if user_signed_in? %>
              <div class="stack">
                <%= link_to "ようこそ、#{current_user.name}さん",
                            user_path(current_user),
                            class: "btn btn-primary welcome-btn" %>

                <%= link_to "新規投稿", new_post_path, class: "btn btn-white" %>
                <%= link_to "ユーザー一覧", users_path, class: "btn btn-white" %>

                <%= button_to "ログアウト", destroy_user_session_path, method: :delete, class: "btn" %>

                <% target_path =
                    case controller_name
                    when "users" then users_path
                    else              posts_path
                    end %>

                <div class="search-wrap">
                  <%= form_with url: target_path, method: :get, local: true,
                                html: { class: "search-form" } do %>
                    <input type="search" name="q" value="<%= params[:q] %>"
                           placeholder="キーワード"
                           class="input" />
                    <button type="submit" class="btn">検索</button>
                  <% end %>
                </div>
              </div>
            <% else %>
              <div class="inline-links">
                <%= link_to "ログイン", new_user_session_path, class: "btn" %>
                <%= link_to "新規登録", new_user_registration_path, class: "btn btn-primary" %>
              </div>
            <% end %>
          </nav>
        </div>
      </div>
    </header>

    <div class="page">
      <div class="flash">
        <% if notice.present? %>
          <p class="notice"><%= notice %></p>
        <% end %>
        <% if alert.present? %>
          <p class="alert"><%= alert %></p>
        <% end %>
      </div>

      <%= yield %>
    </div>
  </body>
</html>
