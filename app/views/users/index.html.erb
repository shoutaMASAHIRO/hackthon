<div class="container">
<style>
:root{
  --bg:#fff;--fg:#0f1419;--muted:#536471;--border:#e6ecf0;
  --accent:#1d9bf0;--accent-contrast:#fff;--pill-bg:#eff3f4;--pill-fg:#0f1419;
  --shadow:0 8px 20px rgba(15,20,25,.05)
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#000;--fg:#e6e9ea;--muted:#8b98a5;--border:#2f3336;
    --accent:#1d9bf0;--accent-contrast:#000;--pill-bg:#16181c;--pill-fg:#e6e9ea;
    --shadow:0 8px 20px rgba(0,0,0,.35)
  }
}

.container{max-width:820px;margin:12px auto 0;padding:0 16px;color:var(--fg)}
.section-title{margin:0 0 8px;font-size:1.4rem;font-weight:700;color:#000!important}
.search-meta{color:#666;margin:6px 0 12px}

.user-list{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:1fr;gap:20px;justify-items:center}
.user-item{width:100%;max-width:720px}

/* カード本体 */
.user-card{
  display:flex;align-items:flex-start;justify-content:space-between;gap:16px;
  border:1px solid var(--border);border-radius:12px;background:var(--bg);
  padding:20px 22px;box-shadow:var(--shadow);
  transition:border-color .15s,transform .06s,box-shadow .15s,background .15s;
  width:100%;
}
.user-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 0 0 3px rgba(29,155,240,.15)}

/* 左側リンク */
.user-card-link{
  flex:1 1 auto;min-width:0;
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  text-decoration:none!important;color:inherit;
}
.user-card-link:focus-visible{outline:none;box-shadow:none}

.user-main{
  display:flex;align-items:center;gap:12px;row-gap:6px;flex-wrap:wrap;min-width:0;
}
.user-name{font-weight:700;white-space:nowrap;max-width:40ch;overflow:hidden;text-overflow:ellipsis}
.user-email{opacity:.95;max-width:36ch;overflow:hidden;text-overflow:ellipsis}
.user-date{color:var(--muted);white-space:nowrap}

/* ピル群 */
.user-stats{
  color:var(--muted);flex:0 1 auto;font-size:.9rem;
  display:flex;flex-wrap:wrap;gap:8px 10px;min-width:180px
}
.pill{
  background:var(--pill-bg);color:var(--pill-fg);border:1px solid var(--border);
  border-radius:999px;padding:4px 10px;font-size:.85rem;font-weight:600;white-space:nowrap
}

/* フォローボタン（Twitter風ブルー） */
.follow-actions{flex:0 0 auto;display:flex;align-items:center;margin-left:4px}

.follow-btn{
  display:inline-flex;align-items:center;gap:.5rem;
  padding:8px 14px;border-radius:999px;font-weight:700;
  border:1px solid #1d9bf0;
  background:#1d9bf0;
  color:#fff;
  transition:background .15s,color .15s,border-color .15s,transform .06s,box-shadow .15s;
  text-decoration:none;cursor:pointer;max-width:100%;
}
.follow-btn:hover,
.follow-btn:focus-visible{
  background:#1a8cd8;
  border-color:#1a8cd8;
  color:#fff;
  outline:none;
  box-shadow:0 0 0 3px rgba(29,155,240,.35);
  transform:translateY(-1px);
}

/* フォロー解除用（アウトライン） */
.follow-btn--outline{
  background:transparent;
  color:#1d9bf0;
  border:1px solid #1d9bf0;
}
.follow-btn--outline:hover,
.follow-btn--outline:focus-visible{
  background:rgba(29,155,240,.1);
  color:#1d9bf0;
  border-color:#1d9bf0;
  box-shadow:0 0 0 3px rgba(29,155,240,.35);
}

/* モバイルは縦積み */
@media (max-width:640px){
  .user-card{flex-direction:column;align-items:stretch;gap:12px}
  .user-card-link{justify-content:flex-start;gap:12px}
  .user-stats{min-width:0}
  .follow-actions{align-self:flex-end}
}

</style>


  <ul class="user-list">
    <% @users.each do |u| %>
      <li class="user-item">
        <div class="user-card">
          <!-- 左：プロフィールへのリンク（カード内） -->
          <%= link_to user_path(u), class: "user-card-link",
                      aria: { label: "#{u.name.presence || u.email} のプロフィールへ" } do %>
            <div class="user-main">
              <span class="user-name"><%= u.name.presence || "(no name)" %></span>
              <span class="user-email"><%= u.email %></span>
              <span class="user-date">登録日: <%= l u.created_at.in_time_zone('Asia/Tokyo'), format: :short %></span>
            </div>
            <div class="user-stats">
              <span class="pill">投稿 <strong><%= u.posts.count %></strong></span>
              <span class="pill">コメント <strong><%= u.comments.count %></strong></span>
              <span class="pill">いいね <strong><%= u.likes.count %></strong></span>
              <span class="pill">フォロワー <strong><%= u.followers.count %></strong></span>
              <span class="pill">フォロー <strong><%= u.following.count %></strong></span>
            </div>
          <% end %>

          <!-- 右：フォローボタン（同じカード内の兄弟要素） -->
          <div id="follow-button-<%= u.id %>" class="follow-actions" aria-live="polite">
            <%= render "users/follow_button", user: u, compact: true %>
          </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>

<div class="pagination-wrapper" style="display:flex;justify-content:center;margin:16px 0 8px;">
  <%= paginate @users %>
</div>
